name: CI/CD Pipeline

# تشغيل سير العمل عند الدفع أو طلبات السحب للفرع الرئيسي
on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

# منح GITHUB_TOKEN الصلاحيات اللازمة للنشر
permissions:
  contents: read

jobs:
  build-and-test:
    name: البناء والاختبار
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [16.x, 18.x, 20.x] # التشغيل على إصدارات متعددة من Node.js

    steps:
    # الخطوة 1: جلب كود المستودع
    - name: جلب المستودع (Checkout repository)
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 # جلب كامل السجل للتحليل الدقيق

    # الخطوة 2: إعداد بيئة Node.js
    - name: إعداد Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm' # تخزين الاعتماديات مؤقتاً لتسريع البناء

    # الخطوة 3: تثبيت الاعتماديات
    - name: تثبيت الاعتماديات (Install dependencies)
      run: npm ci

    # الخطوة 4: تشغيل أداة فحص الكود (اختياري، احذفه إذا لم تستخدم ESLint)
    - name: تشغيل الفاحص (Run Linter)
      run: npm run lint --if-present

    # الخطوة 5: بناء المشروع
    - name: بناء المشروع (Build Project)
      run: npm run build --if-present

    # الخطوة 6: تشغيل الاختبارات
    - name: تشغيل الاختبارات (Run Tests)
      run: npm test
